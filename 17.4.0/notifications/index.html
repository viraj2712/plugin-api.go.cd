<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href="../images/gocd.ico" rel="shortcut icon" type="image/x-icon" />
    <link href="../images/gocd.png" rel="apple-touch-icon" type="image/png" size="192x192" />
    <title>GoCD Notification Plugin API Reference</title>

    <style>
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight, .highlight .w {
  color: #f8f8f2;
  background-color: #272822;
}
.highlight .err {
  color: #151515;
  background-color: #ac4142;
}
.highlight .c, .highlight .cd, .highlight .cm, .highlight .c1, .highlight .cs {
  color: #505050;
}
.highlight .cp {
  color: #f4bf75;
}
.highlight .nt {
  color: #f4bf75;
}
.highlight .o, .highlight .ow {
  color: #d0d0d0;
}
.highlight .p, .highlight .pi {
  color: #d0d0d0;
}
.highlight .gi {
  color: #90a959;
}
.highlight .gd {
  color: #ac4142;
}
.highlight .gh {
  color: #6a9fb5;
  background-color: #151515;
  font-weight: bold;
}
.highlight .k, .highlight .kn, .highlight .kp, .highlight .kr, .highlight .kv {
  color: #aa759f;
}
.highlight .kc {
  color: #d28445;
}
.highlight .kt {
  color: #d28445;
}
.highlight .kd {
  color: #d28445;
}
.highlight .s, .highlight .sb, .highlight .sc, .highlight .sd, .highlight .s2, .highlight .sh, .highlight .sx, .highlight .s1 {
  color: #90a959;
}
.highlight .sr {
  color: #75b5aa;
}
.highlight .si {
  color: #8f5536;
}
.highlight .se {
  color: #8f5536;
}
.highlight .nn {
  color: #f4bf75;
}
.highlight .nc {
  color: #f4bf75;
}
.highlight .no {
  color: #f4bf75;
}
.highlight .na {
  color: #6a9fb5;
}
.highlight .m, .highlight .mf, .highlight .mh, .highlight .mi, .highlight .il, .highlight .mo, .highlight .mb, .highlight .mx {
  color: #90a959;
}
.highlight .ss {
  color: #90a959;
}
    </style>
    <link href="../stylesheets/screen.css" rel="stylesheet" media="screen" />
    <link href="../stylesheets/print.css" rel="stylesheet" media="print" />

      <script src="../javascripts/all.js"></script>


      <script>
        $(function() {
          setupLanguages([]);
        });
      </script>
  </head>

  <body class="notifications notifications_index" data-languages="[]">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="../images/navbar.png" alt="Navbar" />
      </span>
    </a>
    <div class="tocify-wrapper">
      <img src="../images/logo.png" alt="Logo" />
        <div class="lang-selector">
        </div>
      <div class="version-switcher">
        <span>Switch version:</span> <select></select>
      </div>
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <div id="toc">
      </div>
        <ul class="toc-footer">
            <li><a href='https://github.com/gocd/plugin-api.go.cd'>Edit this guide on GitHub</a></li>
            <li><a href='https://api.gocd.io'>GoCD API Documentation</a></li>
            <li><a href='https://docs.gocd.io'>GoCD User Documentation</a></li>
        </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id="notification-plugins">Notification Plugins</h1>

<p>Notification extension endpoint allows GoCD to send notifications about builds over various channels.</p>

<p>If you&rsquo;re looking to start away with a basic template for notification plugins, we recommend forking this <a href="https://github.com/gocd-contrib/notification-skeleton-plugin">github repository</a>.</p>

<h1 id="getting-started">Getting started</h1>

<p>Plugins in GoCD are implemented in Java and packaged as a JAR file.</p>

<h2 id="structure-of-a-gocd-plugin">Structure of a GoCD Plugin</h2>

<blockquote>
<p>A plugin for GoCD is a JAR file with the following structure</p>
</blockquote>

<pre class="highlight plaintext"><code>plugin.jar
|
|-- plugin.xml
|-- com
|   \-- example
|       \-- go
|           \-- testplugin
|               \-- ConsoleOutNotificationPlugin.class
|               \-- x.class
|               \-- y.class
\-- lib
    \-- dependency-1.jar
    \-- dependency-2.jar
</code></pre>

<p>The plugin jar is a self contained-jar, it is expected to contain the following inside it —</p>

<ul>
<li><code class="prettyprint">plugin.xml</code> — the <a href="#the-plugin-metadata">metadata</a> of your plugin</li>
<li>the <a href="#the-plugin-extension-class">plugin extension class</a> <code class="prettyprint">ConsoleOutNotificationPlugin.class</code>, and any other classes that form your plugin.</li>
<li>any optional <a href="#the-plugin-dependencies">dependencies</a> your plugin may requires (inside the <code class="prettyprint">lib</code>)</li>
</ul>

<p><a id='the-plugin-metadata'></a></p>

<h3 id="the-plugin-metadata-plugin-xml">The plugin metadata <code class="prettyprint">plugin.xml</code></h3>

<blockquote>
<p>Here is an example <code class="prettyprint">plugin.xml</code></p>
</blockquote>

<pre class="highlight xml"><code><span class="cp">&lt;?xml version="1.0" encoding="utf-8" ?&gt;</span>
<span class="c">&lt;!-- Your plugin id and version
     of this XML document, the
     version must be set to "1" --&gt;</span>
<span class="nt">&lt;go-plugin</span>
  <span class="na">id=</span><span class="s">"com.example.rocket.launcher"</span>
  <span class="na">version=</span><span class="s">"1"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;about&gt;</span>
    <span class="c">&lt;!-- The name of your plugin --&gt;</span>
    <span class="nt">&lt;name&gt;</span>Launches rockets<span class="nt">&lt;/name&gt;</span>
    <span class="c">&lt;!--  The version of your plugin --&gt;</span>
    <span class="nt">&lt;version&gt;</span>0.0.1<span class="nt">&lt;/version&gt;</span>
    <span class="c">&lt;!-- The minimum version of GoCD that this plugin requires --&gt;</span>
    <span class="nt">&lt;target-go-version&gt;</span>15.1.0<span class="nt">&lt;/target-go-version&gt;</span>
    <span class="c">&lt;!-- A longer description of your plugin  --&gt;</span>
    <span class="nt">&lt;description&gt;</span>Launches rockets, spaceships and other things to a destination of your choice.<span class="nt">&lt;/description&gt;</span>

    <span class="c">&lt;!-- Tell us who you are --&gt;</span>
    <span class="nt">&lt;vendor&gt;</span>
      <span class="nt">&lt;name&gt;</span>ACME Corp<span class="nt">&lt;/name&gt;</span>
      <span class="nt">&lt;url&gt;</span>https://www.example.com<span class="nt">&lt;/url&gt;</span>
    <span class="nt">&lt;/vendor&gt;</span>

    <span class="c">&lt;!-- If this plugin only supports certain OSes --&gt;</span>
    <span class="nt">&lt;target-os&gt;</span>
      <span class="nt">&lt;value&gt;</span>Linux<span class="nt">&lt;/value&gt;</span>
      <span class="nt">&lt;value&gt;</span>Windows<span class="nt">&lt;/value&gt;</span>
    <span class="nt">&lt;/target-os&gt;</span>
  <span class="nt">&lt;/about&gt;</span>
<span class="nt">&lt;/go-plugin&gt;</span>
</code></pre>

<p>This is an XML file that should be present in the plugin jar file at the top level.</p>

<p>You can find the XML Schema for the plugins in the  <a href="https://github.com/gocd/gocd/blob/master/plugin-infra/go-plugin-api/resources/plugin-descriptor.xsd">main repository</a>.</p>

<p><a name='the-plugin-extension-class'></a></p>

<h3 id="the-plugin-extension-class">The plugin extension class</h3>

<blockquote>
<p>Add this to your maven <code class="prettyprint">pom.xml</code></p>
</blockquote>

<pre class="highlight xml"><code><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>cd.go.plugin<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>go-plugin-api<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>17.4.0<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre>

<p>In order to use the plugin extension class, you must add the following to your maven dependencies. If you&rsquo;re using <a href="https://gradle.org">gradle</a>, then use <code class="prettyprint">cd.go.plugin:go-plugin-api:17.4.0</code>. You can find the latest version of the plugin in <a href="http://mvnrepository.com/artifact/cd.go.plugin/go-plugin-api">maven central</a>.</p>

<div style='clear: both;'></div>

<blockquote>
<p>An example plugin class implementation</p>
</blockquote>

<pre class="highlight java"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">example</span><span class="o">.</span><span class="na">go</span><span class="o">.</span><span class="na">testplugin</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.thoughtworks.go.plugin.api.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.thoughtworks.go.plugin.api.annotation.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.thoughtworks.go.plugin.api.exceptions.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.thoughtworks.go.plugin.api.request.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.thoughtworks.go.plugin.api.response.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.google.gson.Gson</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="nd">@Extension</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ConsoleOutNotificationPlugin</span> <span class="kd">implements</span> <span class="n">GoPlugin</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="n">GoApplicationAccessor</span> <span class="n">accessor</span><span class="o">;</span>

  <span class="c1">// this method is executed once at startup</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="n">initializeGoApplicationAccessor</span><span class="o">(</span><span class="n">GoApplicationAccessor</span> <span class="n">accessor</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">accessor</span> <span class="o">=</span> <span class="n">accessor</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="c1">// a GoPluginIdentifier tells GoCD what kind of a plugin this is</span>
  <span class="c1">// and what version(s) of the request/response API it supports</span>
  <span class="kd">public</span> <span class="n">GoPluginIdentifier</span> <span class="n">pluginIdentifier</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">GoPluginIdentifier</span><span class="o">(</span><span class="s">"notification"</span><span class="o">,</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="s">"2.0"</span><span class="o">))</span>
  <span class="o">}</span>

  <span class="c1">// handle the request and return a response</span>
  <span class="c1">// the response is very much like a HTTP response —</span>
  <span class="c1">// it has a status code, a response body and optional headers</span>
  <span class="kd">public</span> <span class="n">GoPluginApiResponse</span> <span class="n">handle</span><span class="o">(</span><span class="n">GoPluginApiRequest</span> <span class="n">request</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">UnhandledRequestTypeException</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">requestName</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="s">"go.plugin-settings.get-view"</span><span class="o">))</span> <span class="o">{</span>
      <span class="n">String</span> <span class="n">viewHtml</span> <span class="o">=</span> <span class="n">read</span><span class="o">(</span><span class="n">getClass</span><span class="o">().</span><span class="na">getResourceAsStream</span><span class="o">(</span><span class="s">"/plugin-settings.template.html"</span><span class="o">));</span>
      <span class="k">return</span> <span class="k">new</span> <span class="n">DefaultGoPluginApiResponse</span><span class="o">(</span><span class="mi">200</span><span class="o">,</span> <span class="n">viewHtml</span><span class="o">);</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">requestName</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="s">"go.plugin-settings.validate-configuration"</span><span class="o">))</span> <span class="o">{</span>
      <span class="n">List</span> <span class="n">errors</span> <span class="o">=</span> <span class="n">validate</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
      <span class="k">return</span> <span class="k">new</span> <span class="n">DefaultGoPluginApiResponse</span><span class="o">(</span><span class="mi">200</span><span class="o">,</span> <span class="k">new</span> <span class="n">Gson</span><span class="o">().</span><span class="na">toJson</span><span class="o">(</span><span class="n">errors</span><span class="o">));</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="n">UnhandledRequestTypeException</span><span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">requestName</span><span class="o">());</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre>

<p>The plugin extension class is a Java class that implements the <code class="prettyprint">GoPlugin</code> interface.</p>

<p>The other types in the example are —</p>

<p class='attributes-table-follows'></p>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#requests-to-the-gocd-server"><code class="prettyprint">GoApplicationAccessor</code></a></td>
<td>So that the plugin can make requests to the GoCD application to get additional information that is not provided by each request. For example, the plugin can ask for settings, credentials etc.</td>
</tr>
<tr>
<td><code class="prettyprint">GoPluginIdentifier</code></td>
<td>Provides information about the type of plugin and the version of the request/response it supports.</td>
</tr>
<tr>
<td><code class="prettyprint">GoPluginApiRequest</code></td>
<td>Represents the request message sent from GoCD to a plugin. The message will have a name and an optional JSON request body and the version of the extension.</td>
</tr>
<tr>
<td><code class="prettyprint">GoPluginApiResponse</code></td>
<td>Represents the response message as a result of processing the <code class="prettyprint">GoPluginApiRequest</code>. Similar to <code class="prettyprint">GoPluginApiRequest</code>, the response will have a status code and an optional JSON response body.</td>
</tr>
</tbody></table>

<p>If you&rsquo;re familiar with http request/responses handled by a web application, you will find this very familiar.</p>

<aside class="notice">
  GoCD has built in support for allowing plugins to enhance their capabilities in the future without having to break compatibility. This is achieved by ensuring that each extension-point and messages that are sent to the plugin are versioned.
</aside>

<p><a id='the-plugin-dependencies'></a></p>

<h3 id="the-plugin-dependencies">The plugin dependencies</h3>

<p>Any dependencies that your plugin requires, should go into the <code class="prettyprint">lib</code> directory inside the plugin JAR.</p>

<h1 id="requests-from-the-gocd-server">Requests from the GoCD server</h1>

<p>In order to implement an elastic agent extension point the following messages must be implemented by the plugin.</p>

<ul>
<li><a href="#notifications-interested-in">Notifications Interested In</a></li>
<li><a href="#stage-status-changed">Stage Status Changed</a></li>
</ul>

<p>These are general purpose messages that a plugin may implement to allow users to configure the plugin through the browser.</p>

<ul>
<li><a href="#get-settings-view">Get Settings View</a></li>
<li><a href="#get-plugin-configuration">Get Plugin Configuration</a></li>
<li><a href="#validate-plugin-configuration">Validate Plugin Configuration</a></li>
</ul>

<h2 id="notifications-interested-in">Notifications Interested In</h2>

<p>This message is a request to the plugin to check what sort of notifications the plugin is interested to receive.</p>

<p class='request-name-heading'>Request name</p>

<p><code class="prettyprint">notifications-interested-in</code></p>

<p class='request-body-heading'>Request body</p>

<p>The server will not provide a request body.</p>

<p class='response-code-heading'>Response code</p>

<p>The plugin is expected to return status <code class="prettyprint">200</code> if it can understand the request.</p>

<p class='response-body-heading'>Response Body</p>

<p>The plugin is expected to return a JSON object with the key <code class="prettyprint">notifications</code> that lists all notifications.</p>

<p>Currently supported notifications include:</p>

<ul>
<li><code class="prettyprint">stage-status</code>. See <a href="#stage-status-changed">stage status changed</a> for the information that the plugin receives on stage status change.</li>
</ul>

<blockquote>
<p>An example response body</p>
</blockquote>

<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"notifications"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"stage-status"</span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h2 id="stage-status-changed">Stage Status Changed</h2>

<p>This message is sent by the server, when it wants to notify the plugin about a &ldquo;stage status change&rdquo;.</p>

<p class='request-name-heading'>Request name</p>

<p><code class="prettyprint">stage-status</code></p>

<p class='request-body-heading'>Request body</p>

<blockquote>
<p>An example stage status changed request body</p>
</blockquote>

<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"pipeline"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"pipeline-name"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"counter"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"label"</span><span class="p">:</span><span class="w"> </span><span class="s2">"pipeline-label"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"group"</span><span class="p">:</span><span class="w"> </span><span class="s2">"pipeline-group"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"build-cause"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nt">"material"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nt">"git-configuration"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"shallow-clone"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
            </span><span class="nt">"branch"</span><span class="p">:</span><span class="w"> </span><span class="s2">"branch"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://user:******@gitrepo.com"</span><span class="w">
          </span><span class="p">},</span><span class="w">
          </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"git"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"changed"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
        </span><span class="nt">"modifications"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
          </span><span class="p">{</span><span class="w">
            </span><span class="nt">"revision"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"modified-time"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-04-06T12:50:03.317Z"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span><span class="w">
          </span><span class="p">}</span><span class="w">
        </span><span class="p">]</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nt">"stage"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"stage-name"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"counter"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"approval-type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"success"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"approved-by"</span><span class="p">:</span><span class="w"> </span><span class="s2">"changes"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"state"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Passed"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"result"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Passed"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"create-time"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2011-07-13T19:43:37.100Z"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"last-transition-time"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2011-07-13T19:43:39.100Z"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"jobs"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"job-name"</span><span class="p">,</span><span class="w">
          </span><span class="nt">"schedule-time"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2011-07-13T19:43:37.100Z"</span><span class="p">,</span><span class="w">
          </span><span class="nt">"assign-time"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2011-07-13T19:43:38.100Z"</span><span class="p">,</span><span class="w">
          </span><span class="nt">"complete-time"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2011-07-13T19:43:39.100Z"</span><span class="p">,</span><span class="w">
          </span><span class="nt">"state"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Completed"</span><span class="p">,</span><span class="w">
          </span><span class="nt">"result"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Passed"</span><span class="p">,</span><span class="w">
          </span><span class="nt">"agent-uuid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"uuid"</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>The request body will contain a JSON representing the stage.</p>

<p class='response-code-heading'>Response code</p>

<p>The plugin is expected to return status <code class="prettyprint">200</code> if it can understand the request.</p>

<p class='response-body-heading'>Response Body</p>

<blockquote>
<p>An example response body if the plugin could send the notification successfully</p>
</blockquote>

<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"success"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<blockquote>
<p>An example response body if the plugin could not send the notification</p>
</blockquote>

<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"failure"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"messages"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"Could not send email for build/1/compile/1"</span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>The plugin is expected to return a JSON object to indicate if the notifications could be processed.</p>

<aside class="warning">
  <strong>Note</strong>: If plugin responds with error messages Go Server shows those in &ldquo;server health messages&rdquo;.
</aside>

<h2 id="get-settings-view">Get Settings View</h2>

<p>This is an optional message that the plugin may implement, should users want to configure the plugin from the GoCD admin page.</p>

<p class='request-name-heading'>Request name</p>

<p><code class="prettyprint">go.plugin-settings.get-view</code></p>

<p class='request-body-heading'>Request body</p>

<p>The server will not provide a request body.</p>

<p class='response-code-heading'>Response code</p>

<p>The plugin is expected to return status <code class="prettyprint">200</code> if it can understand the request.</p>

<p class='response-body-heading'>Response Body</p>

<p>A JSON <a href="#the-get-settings-view-object">settings view object</a></p>

<blockquote>
<p>An example response body</p>
</blockquote>

<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"template"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;div&gt;some html&lt;/div&gt;"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h2 id="get-plugin-configuration">Get Plugin Configuration</h2>

<p>This is an optional message that the plugin may implement, should users want to configure the plugin from the GoCD admin page. This message allows the server to query a plugin about what properties are supported by this plugin.</p>

<p class='request-name-heading'>Request name</p>

<p><code class="prettyprint">go.plugin-settings.get-configuration</code></p>

<p class='request-body-heading'>Request body</p>

<p>The server will not provide a request body.</p>

<p class='response-code-heading'>Response code</p>

<p>The plugin is expected to return status <code class="prettyprint">200</code> if it can understand the request.</p>

<p class='response-body-heading'>Response Body</p>

<p>A JSON <a href="#the-plugin-settings-configuration-object">plugin settings configuration object</a>.</p>

<h2 id="validate-plugin-configuration">Validate Plugin Configuration</h2>

<p>If a plugin requires any configuration, this message must be implemented in order to validate the configuration.</p>

<p class='request-name-heading'>Request name</p>

<p><code class="prettyprint">go.plugin-settings.validate-configuration</code></p>

<p class='request-body-heading'>Request body</p>

<blockquote>
<p>An example validation request body</p>
</blockquote>

<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"plugin-settings"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"server_url"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://localhost.com"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"username"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"user"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"password"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"password"</span><span class="w">
      </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>The request body will contain a JSON with an attribute <code class="prettyprint">plugin-settings</code>, which contains an object with the configuration keys and values that the plugin is expected to validate.</p>

<p class='response-code-heading'>Response code</p>

<p>The plugin is expected to return status <code class="prettyprint">200</code> if it can understand the request.</p>

<p class='response-body-heading'>Response Body</p>

<blockquote>
<p>The plugin should respond with JSON array response for each configuration key that has a validation error</p>
</blockquote>

<pre class="highlight json"><code><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
   </span><span class="nt">"key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"server_url"</span><span class="p">,</span><span class="w">
   </span><span class="nt">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Server URL cannot be localhost"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre>

<p>If any of the input keys have a validation error on them, the plugin is expected to return a list of <a href="#the-validation-error-object">validation error objects</a>. If the configuration is valid, the plugin should return an empty JSON array.</p>

<h1 id="requests-to-the-gocd-server">Requests to the GoCD server</h1>

<p>The plugin may make the following requests to the server using <code class="prettyprint">GoApplicationAccessor#submit(GoApiRequest)</code></p>

<ul>
<li><a href="#get-plugin-settings">Get Plugin Settings</a></li>
</ul>

<h2 id="get-plugin-settings">Get Plugin Settings</h2>

<pre class="highlight java"><code><span class="kn">import</span> <span class="nn">com.thoughtworks.go.plugin.api.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.thoughtworks.go.plugin.api.annotation.Extension</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.thoughtworks.go.plugin.api.logging.Logger</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.thoughtworks.go.plugin.api.request.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.thoughtworks.go.plugin.api.response.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.google.gson.Gson</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>

<span class="nd">@Extension</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ConsoleLogNotificationPlugin</span> <span class="kd">implements</span> <span class="n">GoPlugin</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="n">GoApplicationAccessor</span> <span class="n">accessor</span><span class="o">;</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Logger</span> <span class="n">LOG</span> <span class="o">=</span> <span class="n">Logger</span><span class="o">.</span><span class="na">getLoggerFor</span><span class="o">(</span><span class="n">ConsoleLogNotificationPlugin</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

  <span class="kd">public</span> <span class="kt">void</span> <span class="n">initializeGoApplicationAccessor</span><span class="o">(</span><span class="n">GoApplicationAccessor</span> <span class="n">accessor</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">accessor</span> <span class="o">=</span> <span class="n">accessor</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="n">GoPluginIdentifier</span> <span class="n">pluginIdentifier</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">GoPluginIdentifier</span><span class="o">(</span><span class="s">"notification"</span><span class="o">,</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="s">"2.0"</span><span class="o">))</span>
  <span class="o">}</span>

  <span class="kd">private</span> <span class="n">PluginSettings</span> <span class="n">getSettings</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">Gson</span> <span class="n">gson</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Gson</span><span class="o">();</span>
    <span class="c1">// create a request</span>
    <span class="n">DefaultGoApiRequest</span> <span class="n">request</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultGoApiRequest</span><span class="o">(</span>
      <span class="s">"go.processor.plugin-settings.get"</span><span class="o">,</span>
      <span class="s">"1.0"</span><span class="o">,</span>
      <span class="n">pluginIdentifier</span><span class="o">()</span>
    <span class="o">);</span>

    <span class="c1">// set the request body</span>
    <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">map</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;&gt;();</span>
    <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"plugin-id"</span><span class="o">,</span> <span class="s">"com.example.rocket.launcher"</span><span class="o">);</span>
    <span class="n">request</span><span class="o">.</span><span class="na">setRequestBody</span><span class="o">(</span><span class="n">gson</span><span class="o">.</span><span class="na">toJson</span><span class="o">(</span><span class="n">map</span><span class="o">));</span>

    <span class="c1">// submit the request</span>
    <span class="n">GoApiResponse</span> <span class="n">response</span> <span class="o">=</span> <span class="n">accessor</span><span class="o">.</span><span class="na">submit</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>

    <span class="c1">// check status</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">response</span><span class="o">.</span><span class="na">responseCode</span><span class="o">()</span> <span class="o">!=</span> <span class="mi">200</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">LOG</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">"The server sent an unexpected status code "</span> <span class="o">+</span> <span class="n">response</span><span class="o">.</span><span class="na">responseCode</span><span class="o">()</span> <span class="o">+</span> <span class="s">" with the response body "</span> <span class="o">+</span> <span class="n">response</span><span class="o">.</span><span class="na">responseBody</span><span class="o">());</span>
    <span class="o">}</span>

    <span class="c1">// parse the response, using a json parser of your choice</span>
    <span class="k">return</span> <span class="n">gson</span><span class="o">.</span><span class="na">fromJson</span><span class="o">(</span><span class="n">response</span><span class="o">.</span><span class="na">responseBody</span><span class="o">(),</span> <span class="n">PluginSettings</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre>

<p>This messages allows a plugin to query the server to get the user configured settings for this plugin.</p>

<p class='request-name-heading'>Request name</p>

<p><code class="prettyprint">go.processor.plugin-settings.get</code></p>

<p class='request-body-heading'>Request body</p>

<blockquote>
<p>An example request body</p>
</blockquote>

<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"plugin-id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sample-plugin-id"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Must be a JSON object with a key <code class="prettyprint">plugin-id</code> with the value being the ID of your plugin.</p>

<p class='response-code-heading'>Response code</p>

<p>The server is expected to return status <code class="prettyprint">200</code> if it could process the request.</p>

<p class='response-body-heading'>Response Body</p>

<blockquote>
<p>An example response body</p>
</blockquote>

<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"server_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://build.go.cd"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"username"</span><span class="p">:</span><span class="w"> </span><span class="s2">"view"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"password"</span><span class="p">:</span><span class="w"> </span><span class="s2">"password"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>The server will send a map of settings.</p>

<h1 id="request-response-json-objects">Request/Response JSON Objects</h1>

<p><a id='the-get-settings-view-object'></a></p>

<h3 id="the-settings-view-object">The Settings View Object</h3>

<blockquote>
<p>Here&rsquo;s an example of the settings view object</p>
</blockquote>

<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"template"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;div class=\"form_item_block\"&gt;...&lt;/div&gt;"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p class='attributes-table-follows'></p>

<table><thead>
<tr>
<th>Attribute</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">template</code></td>
<td>String</td>
<td>A string containing an HTML AngularJS based view.</td>
</tr>
</tbody></table>

<p>This template is an <a href="https://angularjs.org">AngularJS</a> based template.</p>

<p>GoCD uses Angular JS as its template engine for the plugin UI. This allows plugin authors to use a limited set of AngularJS features to specify how the UI of their plugins looks.</p>

<aside class='notice'>
  <strong>Note:</strong> Some plugin endpoints, like the Package Repository plugin, do not use this for their view.
</aside>

<div style='clear: both;'></div>

<h4 id="getting-started-with-angularjs-based-templates">Getting started with AngularJS based templates</h4>

<blockquote>
<p>Given a configuration —</p>
</blockquote>

<pre class="highlight xml"><code><span class="nt">&lt;configuration&gt;</span>
  <span class="nt">&lt;property&gt;</span>
    <span class="nt">&lt;key&gt;</span>username<span class="nt">&lt;/key&gt;</span>
    <span class="nt">&lt;value&gt;</span>alice<span class="nt">&lt;/username&gt;</span>
  <span class="nt">&lt;/property&gt;</span>
<span class="nt">&lt;/configuration&gt;</span>
</code></pre>

<blockquote>
<p>This gets converted into the following JSON representation in the browser —</p>
</blockquote>

<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"username"</span><span class="p">:</span><span class="w"> </span><span class="s2">"alice"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<blockquote>
<p>The AngularJS template is expected to bind to the JSON object shown above —</p>
</blockquote>

<pre class="highlight html"><code><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"form_item_block"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;label&gt;</span>Username:<span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">'asterix'</span><span class="nt">&gt;</span>*<span class="nt">&lt;/span&gt;&lt;/label&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">ng-model=</span><span class="s">"username"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre>

<p>When an Angular template is used in a Go plugin, to define the configuration UI, the configuration key which is stored in the configuration XML is used everywhere and is expected to be consistent. Since Angular works off of JSON, GoCD will make sure that the key in the JSON provided to the Angular template is the same as the key in the configuration XML.</p>

<p>Suppose the key of the configuration property stored in the XML is &ldquo;username&rdquo;, with value, &ldquo;alice&rdquo;, then Go will make sure that the value is available to the template as &ldquo;username&rdquo; when used in an Angular-specific HTML attribute like &ldquo;ng-model&rdquo;.</p>

<div style='clear: both;'></div>

<h4 id="showing-validation-errors-in-the-ui">Showing validation errors in the UI</h4>

<blockquote>
<p>We use some simple string replacement<br/>
to substitute <code class="prettyprint">GOINPUTNAME</code> with a unique identifier<br/>
for your plugin in order to render<br/>
any server side errors</p>
</blockquote>

<pre class="highlight html"><code><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"form_item_block"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;label&gt;</span>Username:<span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">'asterix'</span><span class="nt">&gt;</span>*<span class="nt">&lt;/span&gt;&lt;/label&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">ng-model=</span><span class="s">"username"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"form_error"</span> <span class="na">ng-show=</span><span class="s">"GOINPUTNAME[username].$error.server"</span><span class="nt">&gt;</span>
    {{ GOINPUTNAME[username].$error.server}}
  <span class="nt">&lt;/span&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre>

<p>In case of validation errors returned by <code class="prettyprint">go.plugin-settings.validate-configuration</code>, the error messages needs to be populated on the UI, use the snippet here to show the validation errors.</p>

<p><a id='the-plugin-settings-configuration-object'></a></p>

<h3 id="the-plugin-settings-configuration-object">The Plugin Settings Configuration Object</h3>

<blockquote>
<p>Here&rsquo;s an example of the plugin settings configuration object</p>
</blockquote>

<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"server_url"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"display-name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Server URL"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"display-order"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nt">"username"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"required"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nt">"display-name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Username"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"display-order"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nt">"password"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"secure"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="nt">"required"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nt">"display-name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Password"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"display-order"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p class='attributes-table-follows'></p>

<table><thead>
<tr>
<th>Attribute</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">display-name</code></td>
<td>String</td>
<td>The name of the property.</td>
</tr>
<tr>
<td><code class="prettyprint">default-value</code></td>
<td>String</td>
<td>The default value of the property.</td>
</tr>
<tr>
<td><code class="prettyprint">display-order</code></td>
<td>String</td>
<td>A string containing a numerical value.</td>
</tr>
<tr>
<td><code class="prettyprint">required</code></td>
<td>Boolean</td>
<td>If the field is mandatory.</td>
</tr>
<tr>
<td><code class="prettyprint">secure</code></td>
<td>Boolean</td>
<td>If the data in the field should be stored encrypted.</td>
</tr>
</tbody></table>

<p><a id='the-plugin-settings-configuration-object'></a></p>

<h3 id="the-validation-error-object">The Validation Error Object</h3>

<blockquote>
<p>Here&rsquo;s an example of the validation error object</p>
</blockquote>

<pre class="highlight json"><code><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nt">"key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"email_address"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Email address is invalid"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nt">"key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"password"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Password must be provided"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre>

<p class='attributes-table-follows'></p>

<table><thead>
<tr>
<th>Attribute</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">key</code></td>
<td>String</td>
<td>The name of configuration key that has an error.</td>
</tr>
<tr>
<td><code class="prettyprint">message</code></td>
<td>String</td>
<td>The error message associated with that key.</td>
</tr>
</tbody></table>

      </div>
      <div class="dark-box">
          <div class="lang-selector">
          </div>
      </div>
    </div>
  </body>
</html>
